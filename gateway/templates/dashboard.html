<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Arc Agent Gateway | Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-[#050a18] text-slate-300 h-screen flex overflow-hidden font-sans">
    
    <div class="w-1/4 bg-[#081024] border-r border-slate-800 p-6 flex flex-col">
        <div class="mb-10"><h1 class="text-white font-bold text-2xl tracking-tighter">ARC GATEWAY</h1></div>
        <div class="space-y-8">
            <div>
                <h3 class="text-xs font-bold text-blue-500 uppercase mb-4 tracking-widest">Security Protocol</h3>
                <ul class="text-[11px] space-y-4 leading-relaxed">
                    <li class="flex items-start"><i class="fas fa-shield-alt text-blue-400 mt-1 mr-3"></i> <span><b>Autonomous Guardrails:</b> Agent strictly enforces budget limits before signing transactions.</span></li>
                    <li class="flex items-start"><i class="fas fa-link text-blue-400 mt-1 mr-3"></i> <span><b>On-Chain Verification:</b> Gateway validates Tx hashes against Arc RPC nodes.</span></li>
                    <li class="flex items-start"><i class="fas fa-user-secret text-blue-400 mt-1 mr-3"></i> <span><b>Zero-Trust Paywall:</b> Data is cryptographically locked until middleware confirms payment.</span></li>
                </ul>
            </div>
        </div>
    </div>

    <div class="flex-1 flex flex-col justify-center items-center relative">
        <div id="blur-overlay" class="absolute inset-0 bg-[#050a18]/90 backdrop-blur-2xl z-20 flex flex-col items-center justify-center transition-all duration-1000">
            <i class="fas fa-fingerprint text-8xl text-red-600 mb-6 animate-pulse"></i>
            <h2 class="text-3xl font-black text-white uppercase tracking-widest">Access Restricted</h2>
            <p class="text-slate-500 mt-2 font-mono text-sm">Waiting for Agent Authorization (HTTP 402)...</p>
        </div>

        <div id="premium-content" class="w-full px-12 opacity-0 transition-all duration-1000">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-green-400 font-black text-3xl">AUDIT DECRYPTED</h2>
                <span id="tx-display" class="text-[10px] font-mono text-slate-600"></span>
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div class="bg-slate-900/50 p-6 rounded-2xl border border-slate-800">
                    <p class="text-[10px] text-slate-500 uppercase mb-1">Verified TVL</p>
                    <p id="data-tvl" class="text-3xl font-bold text-white">$1,240,500.00</p>
                </div>
                <div class="bg-slate-900/50 p-6 rounded-2xl border border-slate-800">
                    <p class="text-[10px] text-slate-500 uppercase mb-1">Risk Score</p>
                    <p id="data-risk" class="text-3xl font-bold text-blue-400">2.1/10</p>
                </div>
                <div class="bg-slate-900/50 p-6 rounded-2xl border border-slate-800 col-span-2">
                    <p class="text-[10px] text-slate-500 uppercase mb-1">Slippage Analysis</p>
                    <p id="data-slip" class="text-xl font-bold text-slate-200">0.04% for $10k swap</p>
                </div>
            </div>
        </div>
    </div>

    <div class="w-1/3 bg-black p-6 border-l border-slate-800 flex flex-col">
        <div class="flex items-center mb-6">
            <span class="h-2 w-2 rounded-full bg-blue-500 animate-ping mr-3"></span>
            <h2 class="text-white text-xs font-bold uppercase tracking-widest">Agent Live Feed</h2>
        </div>
        <div id="log-box" class="flex-1 overflow-y-auto font-mono text-[11px] space-y-3"></div>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', () => { fetch('/api/start-agent/'); });

        setInterval(async () => {
            const res = await fetch('/api/get-logs/');
            const data = await res.json();
            const logBox = document.getElementById('log-box');
            logBox.innerHTML = ''; 
            
            data.logs.forEach(log => {
                let color = 'text-slate-500';
                if(log.type === 'success') color = 'text-green-400';
                if(log.type === 'payment') color = 'text-blue-400';
                if(log.type === 'warning') color = 'text-yellow-500';
                logBox.innerHTML += `<div><span class="text-slate-700">[${log.time}]</span> <span class="${color}">${log.message}</span></div>`;
            });
            logBox.scrollTop = logBox.scrollHeight;

            if (data.payment_status.status === "UNLOCKED") {
                document.getElementById('blur-overlay').classList.add('opacity-0', 'pointer-events-none');
                document.getElementById('premium-content').classList.remove('opacity-0');
                document.getElementById('tx-display').innerText = `Tx: ${data.payment_status.tx_hash.substring(0,20)}...`;
                
                // Fetch the actual premium data to populate fields
                const premRes = await fetch('/api/premium/', {headers: {'Authorization': `Arc ${data.payment_status.tx_hash}`}});
                const premData = await premRes.json();
                document.getElementById('data-tvl').innerText = premData.data.tvl_verified;
                document.getElementById('data-risk').innerText = premData.data.risk_score;
                document.getElementById('data-slip').innerText = premData.data.slippage_analysis;
            }
        }, 1000);
    </script>
</body>
</html>